<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparativo Europeu</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d1b2a">

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#0d1b2a;
  --card:#1b263b;
  --accent:#00aaff;
  --text:#e0e1dd;
}
[data-theme="light"]{
  --bg:#f4f6f8;
  --card:#ffffff;
  --accent:#005fcc;
  --text:#1b263b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(0,0,0,.15);
}
h1{margin:0;font-size:1.2rem;color:var(--accent)}
button,select{
  padding:10px 12px;
  border:none;
  border-radius:10px;
  background:var(--card);
  color:var(--text);
  cursor:pointer;
}
.controls{padding:12px}
.toggle{
  display:flex;
  gap:8px;
  padding:0 12px 12px;
}
.toggle button{flex:1;opacity:.6}
.toggle button.active{
  background:var(--accent);
  color:#000;
  font-weight:600;
  opacity:1;
}
.section{
  padding:12px;
  display:grid;
  gap:12px;
}
@media(min-width:900px){
  .section{grid-template-columns:1fr 1fr}
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
}
.card h2{
  margin:0 0 8px;
  font-size:.95rem;
  color:var(--accent);
}
.row{
  display:flex;
  gap:10px;
  align-items:center;
  margin:8px 0;
}
.label{width:200px;font-size:.85rem}
.bar{flex:1;height:10px;background:rgba(0,0,0,.25);border-radius:5px}
.fill{height:100%;background:var(--accent);border-radius:5px}
.value{width:70px;text-align:right;font-weight:600}
.notice{
  opacity:.7;
  font-size:.9rem;
  padding:10px 0;
}
</style>
</head>

<body data-theme="dark">

<header>
  <h1>Comparativo Europeu</h1>
  <button onclick="alternarTema()">üåì</button>
</header>

<div class="toggle">
  <button id="btnHTFT" class="active">HT √ó FT</button>
  <button id="btnMV">Mandante √ó Visitante</button>
</div>

<div class="controls">
  <select id="mercado">
    <option value="mediaGols">M√©dia de gols</option>
    <option value="vitoriasMandante">Vit√≥rias do mandante</option>
    <option value="vitoriasVisitante">Vit√≥rias do visitante</option>
    <option value="empates">Empates</option>
    <option value="zeroZero">Jogos 0x0</option>
    <option value="over05">Over 0.5 gols</option>
    <option value="under05">Under 0.5 gols</option>
    <option value="over15">Over 1.5 gols</option>
    <option value="under15">Under 1.5 gols</option>
    <option value="over25">Over 2.5 gols</option>
    <option value="under25">Under 2.5 gols</option>
  </select>
</div>

<div class="section">
  <div class="card">
    <h2 id="tituloA"></h2>
    <div id="rankingA"></div>
  </div>
  <div class="card">
    <h2 id="tituloB"></h2>
    <div id="rankingB"></div>
  </div>
</div>

<script>
/* =======================
   CONFIGURA√á√ÉO DE MERCADOS
======================= */
const mercadosValidos = {
  HTFT: [
    'mediaGols','zeroZero',
    'over05','under05',
    'over15','under15',
    'over25','under25',
    'vitoriasMandante',
    'vitoriasVisitante',
    'empates'
  ],
  MV: [
    'vitoriasMandante',
    'vitoriasVisitante',
    'empates'
  ]
};

/* =======================
   LIGAS
======================= */
const ligas = {
  bundesliga:{nome:'üá©üá™ ALEMANHA',url:'https://www.football-data.co.uk/mmz4281/2526/D1.csv',ht:true},
  premier:{nome:'üá¨üáß INGLATERRA',url:'https://www.football-data.co.uk/mmz4281/2526/E0.csv',ht:true},
  laliga:{nome:'üá™üá∏ ESPANHA',url:'https://www.football-data.co.uk/mmz4281/2526/SP1.csv',ht:true},
  seriea:{nome:'üáÆüáπ IT√ÅLIA',url:'https://www.football-data.co.uk/mmz4281/2526/I1.csv',ht:true},
  ligue1:{nome:'üá´üá∑ FRAN√áA',url:'https://www.football-data.co.uk/mmz4281/2526/F1.csv',ht:true},
  eredivisie:{nome:'üá≥üá± HOLANDA',url:'https://www.football-data.co.uk/mmz4281/2526/N1.csv',ht:true},
  portugal:{nome:'üáµüáπ PORTUGAL',url:'https://www.football-data.co.uk/mmz4281/2526/P1.csv',ht:true},
  scotland:{nome:'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø ESC√ìCIA',url:'https://www.football-data.co.uk/mmz4281/2526/SC0.csv',ht:true},

  denmark:{nome:'üá©üá∞ DINAMARCA',url:'https://www.football-data.co.uk/new/DNK.csv',ht:false,season:'2025/2026'},
  switzerland:{nome:'üá®üá≠ SU√ç√áA',url:'https://www.football-data.co.uk/new/SWZ.csv',ht:false,season:'2025/2026'},
  norway:{nome:'üá≥üá¥ NORUEGA',url:'https://www.football-data.co.uk/new/NOR.csv',ht:false,season:'2025'},
  sweden:{nome:'üá∏üá™ SU√âCIA',url:'https://www.football-data.co.uk/new/SWE.csv',ht:false,season:'2025'}
};

let dados=[];
let modoAnalise='HTFT';

/* =======================
   CARREGAMENTO
======================= */
async function carregarTudo(){
  dados=[];
  for(const k in ligas){
    const csv=await fetch('https://corsproxy.io/?'+encodeURIComponent(ligas[k].url)).then(r=>r.text());
    let rows=Papa.parse(csv,{header:true}).data;
    if(ligas[k].season){
      rows=rows.filter(r=>r.SEASON===ligas[k].season);
    }
    dados.push(calcular(rows,ligas[k].nome,ligas[k].ht));
  }
  renderizar();
}

/* =======================
   C√ÅLCULO
======================= */
function calcular(rows,nome,temHT){
  const jogos=rows.filter(r=>r.FTR);
  let ft={g:0,vm:0,vv:0,e:0,z:0,o05:0,o15:0,o25:0};
  let ht={g:0,vm:0,vv:0,e:0,z:0,o05:0,o15:0,o25:0};

  jogos.forEach(j=>{
    const HG=j.FTHG??j.HG??0;
    const AG=j.FTAG??j.AG??0;
    const ftg=(+HG)+(+AG);

    if(j.FTR==='H')ft.vm++; else if(j.FTR==='A')ft.vv++; else ft.e++;
    ft.g+=ftg;
    if(ftg===0)ft.z++;
    if(ftg>=1)ft.o05++;
    if(ftg>=2)ft.o15++;
    if(ftg>=3)ft.o25++;

    if(temHT){
      const hHG=j.HTHG??0;
      const hAG=j.HTAG??0;
      const htg=(+hHG)+(+hAG);
      if(j.HTR==='H')ht.vm++; else if(j.HTR==='A')ht.vv++; else ht.e++;
      ht.g+=htg;
      if(htg===0)ht.z++;
      if(htg>=1)ht.o05++;
      if(htg>=2)ht.o15++;
      if(htg>=3)ht.o25++;
    }
  });

  const t=jogos.length||1;

  return{
    nome,temHT,
    FT:{
      mediaGols:(ft.g/t).toFixed(2),
      vitoriasMandante:(ft.vm/t*100).toFixed(1),
      vitoriasVisitante:(ft.vv/t*100).toFixed(1),
      empates:(ft.e/t*100).toFixed(1),
      zeroZero:(ft.z/t*100).toFixed(1),
      over05:(ft.o05/t*100).toFixed(1),
      under05:((t-ft.o05)/t*100).toFixed(1),
      over15:(ft.o15/t*100).toFixed(1),
      under15:((t-ft.o15)/t*100).toFixed(1),
      over25:(ft.o25/t*100).toFixed(1),
      under25:((t-ft.o25)/t*100).toFixed(1)
    },
    HT: temHT ? {
      mediaGols:(ht.g/t).toFixed(2),
      vitoriasMandante:(ht.vm/t*100).toFixed(1),
      vitoriasVisitante:(ht.vv/t*100).toFixed(1),
      empates:(ht.e/t*100).toFixed(1),
      zeroZero:(ht.z/t*100).toFixed(1),
      over05:(ht.o05/t*100).toFixed(1),
      under05:((t-ht.o05)/t*100).toFixed(1),
      over15:(ht.o15/t*100).toFixed(1),
      under15:((t-ht.o15)/t*100).toFixed(1),
      over25:(ht.o25/t*100).toFixed(1),
      under25:((t-ht.o25)/t*100).toFixed(1)
    }:null
  };
}

/* =======================
   RENDER
======================= */
function renderizar(){
  const m=mercado.value;

  if(!mercadosValidos[modoAnalise].includes(m)){
    tituloA.innerText = modoAnalise==='MV'?'Mandante':'HT';
    tituloB.innerText = modoAnalise==='MV'?'Visitante':'FT';
    rankingA.innerHTML='<div class="notice">Este mercado n√£o se aplica a este modo.</div>';
    rankingB.innerHTML='<div class="notice">Selecione um mercado compat√≠vel.</div>';
    return;
  }

  if(modoAnalise==='HTFT'){
    const lista=dados.filter(d=>d.temHT);
    tituloA.innerText=label(m,'HT');
    tituloB.innerText=label(m,'FT');
    renderRanking(rankingA,lista,'HT',m);
    renderRanking(rankingB,lista,'FT',m);
  }else{
    tituloA.innerText=label(m,'Mandante');
    tituloB.innerText=label(m,'Visitante');
    renderRanking(rankingA,dados,'FT',m,true);
    renderRanking(rankingB,dados,'FT',m,false);
  }
}

function renderRanking(container,lista,periodo,met){
  container.innerHTML='';
  const max=Math.max(...lista.map(d=>+d[periodo][met]));
  lista.sort((a,b)=>+b[periodo][met]-+a[periodo][met]).forEach(d=>{
    const v=d[periodo][met];
    const txt=met==='mediaGols'?v:`${v}%`;
    container.innerHTML+=`
      <div class="row">
        <div class="label">${d.nome}</div>
        <div class="bar"><div class="fill" style="width:${(v/max)*100}%"></div></div>
        <div class="value">${txt}</div>
      </div>`;
  });
}

function label(m,eixo){
  const l={
    mediaGols:'M√©dia de gols',
    vitoriasMandante:'Vit√≥rias do mandante',
    vitoriasVisitante:'Vit√≥rias do visitante',
    empates:'Empates',
    zeroZero:'Jogos 0x0',
    over05:'Over 0.5 gols',
    under05:'Under 0.5 gols',
    over15:'Over 1.5 gols',
    under15:'Under 1.5 gols',
    over25:'Over 2.5 gols',
    under25:'Under 2.5 gols'
  };
  return `${l[m]} ‚Äî ${eixo}`;
}

/* =======================
   UI
======================= */
btnHTFT.onclick=()=>{modoAnalise='HTFT';btnHTFT.classList.add('active');btnMV.classList.remove('active');renderizar();}
btnMV.onclick=()=>{modoAnalise='MV';btnMV.classList.add('active');btnHTFT.classList.remove('active');renderizar();}
mercado.onchange=renderizar;

function alternarTema(){
  document.body.dataset.theme=document.body.dataset.theme==='dark'?'light':'dark';
}

carregarTudo();
</script>

</body>
</html>
