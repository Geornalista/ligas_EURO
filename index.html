<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparativo Europeu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#0d1b2a;
  --card:#1b263b;
  --accent:#00aaff;
  --text:#e0e1dd
}
[data-theme="light"]{
  --bg:#f4f6f8;
  --card:#ffffff;
  --accent:#005fcc;
  --text:#1b263b
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text)
}
header{
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
h1{
  margin:0;
  font-size:1.1rem;
  color:var(--accent)
}
button,select{
  padding:8px 10px;
  border:none;
  border-radius:10px;
  background:var(--card);
  color:var(--text);
  cursor:pointer
}
.tabs{
  display:flex;
  gap:6px;
  padding:0 12px 12px
}
.tabs button{
  flex:1;
  opacity:.6
}
.tabs button.active{
  background:var(--accent);
  color:#000;
  font-weight:600;
  opacity:1
}
.controls{
  padding:0 12px 12px
}
.section{
  padding:12px;
  display:grid;
  gap:12px
}
@media(min-width:900px){
  .section{grid-template-columns:1fr 1fr}
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px
}
.card h2{
  margin:0 0 10px;
  font-size:.9rem;
  color:var(--accent)
}
.row{
  display:flex;
  gap:8px;
  align-items:center;
  margin:6px 0
}
.label{
  width:220px;
  font-size:.85rem
}
.bar{
  flex:1;
  height:8px;
  background:rgba(0,0,0,.25);
  border-radius:4px
}
.fill{
  height:100%;
  background:var(--accent);
  border-radius:4px
}
.value{
  width:60px;
  text-align:right;
  font-weight:600
}
.note{
  opacity:.7;
  font-size:.85rem
}
</style>
</head>

<body data-theme="dark">

<header>
  <h1>Comparativo Europeu</h1>
  <button onclick="alternarTema()">ðŸŒ“</button>
</header>

<div class="tabs">
  <button id="tabFT" class="active">Tempo regulamentar</button>
  <button id="tabHTFT">HT Ã— FT</button>
  <button id="tabMV">Mandante Ã— Visitante</button>
</div>

<div class="controls">
  <select id="mercado"></select>
</div>

<div class="section">
  <div class="card">
    <h2 id="tituloA"></h2>
    <div id="rankingA"></div>
  </div>
  <div class="card">
    <h2 id="tituloB"></h2>
    <div id="rankingB"></div>
  </div>
</div>

<script>
const mercados = {
  FT:['mediaGols','zeroZero','over05','under05','over15','under15','over25','under25','vitoriasMandante','vitoriasVisitante','empates'],
  HTFT:['mediaGols','zeroZero','over05','under05','over15','under15','over25','under25','vitoriasMandante','vitoriasVisitante','empates'],
  MV:['vitoriasMandante','vitoriasVisitante','empates']
};

const labels={
  mediaGols:'MÃ©dia de gols',
  zeroZero:'Jogos 0x0',
  over05:'Over 0.5 gols',
  under05:'Under 0.5 gols',
  over15:'Over 1.5 gols',
  under15:'Under 1.5 gols',
  over25:'Over 2.5 gols',
  under25:'Under 2.5 gols',
  vitoriasMandante:'VitÃ³rias do mandante',
  vitoriasVisitante:'VitÃ³rias do visitante',
  empates:'Empates'
};

const ligas={
  bundesliga:{nome:'ðŸ‡©ðŸ‡ª ALEMANHA',url:'https://www.football-data.co.uk/mmz4281/2526/D1.csv',ht:true},
  bundesliga2:{nome:'ðŸ‡©ðŸ‡ª ALEMANHA-2',url:'https://www.football-data.co.uk/mmz4281/2526/D2.csv',ht:true},
  premier:{nome:'ðŸ‡¬ðŸ‡§ INGLATERRA',url:'https://www.football-data.co.uk/mmz4281/2526/E0.csv',ht:true},
  premier2:{nome:'ðŸ‡¬ðŸ‡§ INGLATERRA-2',url:'https://www.football-data.co.uk/mmz4281/2526/E1.csv',ht:true},
  laliga:{nome:'ðŸ‡ªðŸ‡¸ ESPANHA',url:'https://www.football-data.co.uk/mmz4281/2526/SP1.csv',ht:true},
  laliga2:{nome:'ðŸ‡ªðŸ‡¸ ESPANHA-2',url:'https://www.football-data.co.uk/mmz4281/2526/SP2.csv',ht:true},
  seriea:{nome:'ðŸ‡®ðŸ‡¹ ITÃLIA',url:'https://www.football-data.co.uk/mmz4281/2526/I1.csv',ht:true},
  seriea2:{nome:'ðŸ‡®ðŸ‡¹ ITÃLIA-2',url:'https://www.football-data.co.uk/mmz4281/2526/I2.csv',ht:true},
  ligue1:{nome:'ðŸ‡«ðŸ‡· FRANÃ‡A',url:'https://www.football-data.co.uk/mmz4281/2526/F1.csv',ht:true},
  ligue2:{nome:'ðŸ‡«ðŸ‡· FRANÃ‡A-2',url:'https://www.football-data.co.uk/mmz4281/2526/F2.csv',ht:true},
  eredivisie:{nome:'ðŸ‡³ðŸ‡± HOLANDA',url:'https://www.football-data.co.uk/mmz4281/2526/N1.csv',ht:true},
  portugal:{nome:'ðŸ‡µðŸ‡¹ PORTUGAL',url:'https://www.football-data.co.uk/mmz4281/2526/P1.csv',ht:true},
  scotland:{nome:'ðŸ´ó §ó ¢ó ³ó £ó ´ó ¿ ESCÃ“CIA',url:'https://www.football-data.co.uk/mmz4281/2526/SC0.csv',ht:true},
  belgium:{nome:'ðŸ‡§ðŸ‡ª BÃ‰LGICA',url:'https://www.football-data.co.uk/mmz4281/2526/B1.csv',ht:true},
  turkey:{nome:'ðŸ‡¹ðŸ‡· TURQUIA',url:'https://www.football-data.co.uk/mmz4281/2526/T1.csv',ht:true},
  greece:{nome:'ðŸ‡¬ðŸ‡· GRÃ‰CIA',url:'https://www.football-data.co.uk/mmz4281/2526/G1.csv',ht:true},

  denmark:{nome:'ðŸ‡©ðŸ‡° DINAMARCA',url:'https://www.football-data.co.uk/new/DNK.csv',ht:false},
  switzerland:{nome:'ðŸ‡¨ðŸ‡­ SUÃÃ‡A',url:'https://www.football-data.co.uk/new/SWZ.csv',ht:false},
  norway:{nome:'ðŸ‡³ðŸ‡´ NORUEGA',url:'https://www.football-data.co.uk/new/NOR.csv',ht:false},
  sweden:{nome:'ðŸ‡¸ðŸ‡ª SUÃ‰CIA',url:'https://www.football-data.co.uk/new/SWE.csv',ht:false}
};

let dados=[],aba='FT';

function setMercados(){
  mercado.innerHTML='';
  mercados[aba].forEach(m=>{
    const o=document.createElement('option');
    o.value=m;
    o.textContent=labels[m];
    mercado.appendChild(o);
  });
}

async function carregar(){
  for(const k in ligas){
    const csv = await fetch(
      'https://corsproxy.io/?' + encodeURIComponent(ligas[k].url)
    ).then(r=>r.text());

    const rows = Papa.parse(csv,{header:true}).data;
    dados.push(calc(rows,ligas[k]));
  }
  setMercados();
  render();
}

function calc(rows,liga){
  const jogos = rows.filter(r=>{
    const hg = r.FTHG ?? r.HG;
    const ag = r.FTAG ?? r.AG;
    return hg !== undefined && ag !== undefined && hg !== '' && ag !== '';
  });

  let ft={g:0,z:0,o05:0,o15:0,o25:0,vm:0,vv:0,e:0};
  let ht={g:0,z:0,o05:0,o15:0,o25:0,vm:0,vv:0,e:0};

  jogos.forEach(j=>{
    const hg = j.FTHG ?? j.HG;
    const ag = j.FTAG ?? j.AG;
    const tg = (+hg)+(+ag);

    const resultado = j.FTR || j.Res;

    ft.g+=tg;
    if(tg===0)ft.z++;
    if(tg>=1)ft.o05++;
    if(tg>=2)ft.o15++;
    if(tg>=3)ft.o25++;

    if(resultado==='H')ft.vm++;
    else if(resultado==='A')ft.vv++;
    else if(resultado==='D')ft.e++;

    if(liga.ht){
      const htg=(+(j.HTHG||0))+(+(j.HTAG||0));
      ht.g+=htg;
      if(htg===0)ht.z++;
      if(htg>=1)ht.o05++;
      if(htg>=2)ht.o15++;
      if(htg>=3)ht.o25++;

      if(j.HTR==='H')ht.vm++;
      else if(j.HTR==='A')ht.vv++;
      else if(j.HTR==='D')ht.e++;
    }
  });

  const t=jogos.length||1;
  const pct=x=>(x/t*100).toFixed(1);

  return{
    nome:liga.nome,
    ht:liga.ht,
    FT:{
      mediaGols:(ft.g/t).toFixed(2),
      zeroZero:pct(ft.z),
      over05:pct(ft.o05),
      under05:pct(t-ft.o05),
      over15:pct(ft.o15),
      under15:pct(t-ft.o15),
      over25:pct(ft.o25),
      under25:pct(t-ft.o25),
      vitoriasMandante:pct(ft.vm),
      vitoriasVisitante:pct(ft.vv),
      empates:pct(ft.e)
    },
    HT:liga.ht?{
      mediaGols:(ht.g/t).toFixed(2),
      zeroZero:pct(ht.z),
      over05:pct(ht.o05),
      under05:pct(t-ht.o05),
      over15:pct(ht.o15),
      under15:pct(t-ht.o15),
      over25:pct(ht.o25),
      under25:pct(t-ht.o25),
      vitoriasMandante:pct(ht.vm),
      vitoriasVisitante:pct(ht.vv),
      empates:pct(ht.e)
    }:null
  };
}

function render(){
  rankingA.innerHTML='';
  rankingB.innerHTML='';
  const m=mercado.value;

  if(aba==='FT'){
    tituloA.textContent=labels[m]+' â€” FT';
    tituloB.textContent='Contexto';

    const l=[...dados].sort((a,b)=>b.FT[m]-a.FT[m]);
    const max=Math.max(...l.map(d=>+d.FT[m]));

    l.forEach(d=>{
      rankingA.innerHTML+=row(d.nome,d.FT[m],max,m==='mediaGols');
    });

    rankingB.innerHTML='<div class="note">Leitura complementar do tempo regulamentar.</div>';
  }

  if(aba==='HTFT'){
    const l=dados.filter(d=>d.ht);
    tituloA.textContent=labels[m]+' â€” HT';
    tituloB.textContent=labels[m]+' â€” FT';

    const maxHT=Math.max(...l.map(d=>+d.HT[m]));
    const maxFT=Math.max(...l.map(d=>+d.FT[m]));

    [...l].sort((a,b)=>b.HT[m]-a.HT[m])
      .forEach(d=>rankingA.innerHTML+=row(d.nome,d.HT[m],maxHT,m==='mediaGols'));

    [...l].sort((a,b)=>b.FT[m]-a.FT[m])
      .forEach(d=>rankingB.innerHTML+=row(d.nome,d.FT[m],maxFT,m==='mediaGols'));
  }

  if(aba==='MV'){
    tituloA.textContent='VitÃ³rias do mandante â€” FT';
    tituloB.textContent='VitÃ³rias do visitante â€” FT';

    const maxA=Math.max(...dados.map(d=>+d.FT.vitoriasMandante));
    const maxB=Math.max(...dados.map(d=>+d.FT.vitoriasVisitante));

    [...dados].sort((a,b)=>b.FT.vitoriasMandante-a.FT.vitoriasMandante)
      .forEach(d=>rankingA.innerHTML+=row(d.nome,d.FT.vitoriasMandante,maxA,false));

    [...dados].sort((a,b)=>b.FT.vitoriasVisitante-a.FT.vitoriasVisitante)
      .forEach(d=>rankingB.innerHTML+=row(d.nome,d.FT.vitoriasVisitante,maxB,false));
  }
}

function row(nome,val,max,isMedia){
  return `
  <div class="row">
    <div class="label">${nome}</div>
    <div class="bar">
      <div class="fill" style="width:${(val/max)*100}%"></div>
    </div>
    <div class="value">${isMedia?val:val+'%'}</div>
  </div>`;
}

tabFT.onclick=()=>{aba='FT';activate(tabFT)};
tabHTFT.onclick=()=>{aba='HTFT';activate(tabHTFT)};
tabMV.onclick=()=>{aba='MV';activate(tabMV)};

function activate(btn){
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  setMercados();
  render();
}

mercado.onchange=render;

function alternarTema(){
  document.body.dataset.theme =
    document.body.dataset.theme === 'dark' ? 'light' : 'dark';
}

carregar();
</script>

</body>
</html>
