<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparativo Europeu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#0d1b2a;
  --card:#1b263b;
  --accent:#00aaff;
  --text:#e0e1dd;
}
[data-theme="light"]{
  --bg:#f4f6f8;
  --card:#ffffff;
  --accent:#005fcc;
  --text:#1b263b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;font-size:1.1rem;color:var(--accent)}
button,select{
  padding:8px 10px;
  border:none;
  border-radius:10px;
  background:var(--card);
  color:var(--text);
  cursor:pointer;
}
.tabs{
  display:flex;
  gap:6px;
  padding:0 12px 12px;
}
.tabs button{
  flex:1;
  opacity:.6;
}
.tabs button.active{
  background:var(--accent);
  color:#000;
  font-weight:600;
  opacity:1;
}
.controls{padding:0 12px 12px}
.section{
  padding:12px;
  display:grid;
  gap:12px;
}
@media(min-width:900px){
  .section{grid-template-columns:1fr 1fr}
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
}
.card h2{
  margin:0 0 10px;
  font-size:.9rem;
  color:var(--accent);
}
.row{
  display:flex;
  gap:8px;
  align-items:center;
  margin:6px 0;
}
.label{width:200px;font-size:.85rem}
.bar{flex:1;height:8px;background:rgba(0,0,0,.25);border-radius:4px}
.fill{height:100%;background:var(--accent);border-radius:4px}
.value{width:60px;text-align:right;font-weight:600}
.note{
  opacity:.7;
  font-size:.85rem;
  line-height:1.4;
}
</style>
</head>

<body data-theme="dark">

<header>
  <h1>Comparativo Europeu</h1>
  <button onclick="alternarTema()">ðŸŒ“</button>
</header>

<div class="tabs">
  <button id="tabFT" class="active">Tempo regulamentar</button>
  <button id="tabHTFT">HT Ã— FT</button>
  <button id="tabMV">Mandante Ã— Visitante</button>
</div>

<div class="controls">
  <select id="mercado">
    <option value="mediaGols">MÃ©dia de gols</option>
    <option value="zeroZero">Jogos 0x0</option>
    <option value="over25">Over 2.5 gols</option>
    <option value="under25">Under 2.5 gols</option>
    <option value="vitoriasMandante">VitÃ³rias do mandante</option>
    <option value="vitoriasVisitante">VitÃ³rias do visitante</option>
    <option value="empates">Empates</option>
  </select>
</div>

<div class="section">
  <div class="card">
    <h2 id="tituloA"></h2>
    <div id="rankingA"></div>
  </div>
  <div class="card">
    <h2 id="tituloB"></h2>
    <div id="rankingB"></div>
  </div>
</div>

<script>
const ligas = {
  premier:{nome:'ðŸ‡¬ðŸ‡§ INGLATERRA',url:'https://www.football-data.co.uk/mmz4281/2526/E0.csv',ht:true},
  laliga:{nome:'ðŸ‡ªðŸ‡¸ ESPANHA',url:'https://www.football-data.co.uk/mmz4281/2526/SP1.csv',ht:true},
  seriea:{nome:'ðŸ‡®ðŸ‡¹ ITÃLIA',url:'https://www.football-data.co.uk/mmz4281/2526/I1.csv',ht:true},
  bundesliga:{nome:'ðŸ‡©ðŸ‡ª ALEMANHA',url:'https://www.football-data.co.uk/mmz4281/2526/D1.csv',ht:true},
  ligue1:{nome:'ðŸ‡«ðŸ‡· FRANÃ‡A',url:'https://www.football-data.co.uk/mmz4281/2526/F1.csv',ht:true},
  portugal:{nome:'ðŸ‡µðŸ‡¹ PORTUGAL',url:'https://www.football-data.co.uk/mmz4281/2526/P1.csv',ht:true},
  scotland:{nome:'ðŸ´ó §ó ¢ó ³ó £ó ´ó ¿ ESCÃ“CIA',url:'https://www.football-data.co.uk/mmz4281/2526/SC0.csv',ht:true},

  denmark:{nome:'ðŸ‡©ðŸ‡° DINAMARCA',url:'https://www.football-data.co.uk/new/DNK.csv',ht:false,season:'2025/2026'},
  switzerland:{nome:'ðŸ‡¨ðŸ‡­ SUÃÃ‡A',url:'https://www.football-data.co.uk/new/SWZ.csv',ht:false,season:'2025/2026'},
  norway:{nome:'ðŸ‡³ðŸ‡´ NORUEGA',url:'https://www.football-data.co.uk/new/NOR.csv',ht:false,season:'2025'},
  sweden:{nome:'ðŸ‡¸ðŸ‡ª SUÃ‰CIA',url:'https://www.football-data.co.uk/new/SWE.csv',ht:false,season:'2025'}
};

let dados=[];
let aba='FT';

async function carregar(){
  dados=[];
  for(const k in ligas){
    const csv=await fetch('https://corsproxy.io/?'+encodeURIComponent(ligas[k].url)).then(r=>r.text());
    let rows=Papa.parse(csv,{header:true}).data;
    if(ligas[k].season){
      rows=rows.filter(r=>r.SEASON===ligas[k].season);
    }
    dados.push(calcular(rows,ligas[k]));
  }
  render();
}

function calcular(rows,liga){
  const jogos=rows.filter(r=>r.FTR);
  let ft={g:0,z:0,o25:0,vm:0,vv:0,e:0};
  jogos.forEach(j=>{
    const hg=j.FTHG??j.HG??0;
    const ag=j.FTAG??j.AG??0;
    const tg=(+hg)+(+ag);
    ft.g+=tg;
    if(tg===0)ft.z++;
    if(tg>=3)ft.o25++;
    if(j.FTR==='H')ft.vm++; else if(j.FTR==='A')ft.vv++; else ft.e++;
  });
  const t=jogos.length||1;
  return{
    nome:liga.nome,
    temHT:liga.ht,
    FT:{
      mediaGols:(ft.g/t).toFixed(2),
      zeroZero:(ft.z/t*100).toFixed(1),
      over25:(ft.o25/t*100).toFixed(1),
      under25:((t-ft.o25)/t*100).toFixed(1),
      vitoriasMandante:(ft.vm/t*100).toFixed(1),
      vitoriasVisitante:(ft.vv/t*100).toFixed(1),
      empates:(ft.e/t*100).toFixed(1)
    }
  };
}

function render(){
  const m=mercado.value;
  rankingA.innerHTML='';
  rankingB.innerHTML='';

  tituloA.innerText = titulo(m);
  tituloB.innerText = colunaDireitaTitulo(m);

  const lista=[...dados].sort((a,b)=>b.FT[m]-a.FT[m]);
  const max=Math.max(...lista.map(l=>+l.FT[m]));

  lista.forEach(l=>{
    rankingA.innerHTML+=linha(l.nome,l.FT[m],max);
  });

  // coluna direita
  if(m==='over25'){
    lista.sort((a,b)=>b.FT.under25-a.FT.under25).forEach(l=>{
      rankingB.innerHTML+=linha(l.nome,l.FT.under25,100);
    });
  }else if(m==='mediaGols'){
    rankingB.innerHTML='<div class="note">ComparaÃ§Ã£o visual da intensidade ofensiva mÃ©dia das ligas no tempo regulamentar.</div>';
  }else if(m==='zeroZero'){
    rankingB.innerHTML='<div class="note">Percentual de jogos com pelo menos um gol = 100% âˆ’ 0x0.</div>';
  }else{
    rankingB.innerHTML='<div class="note">Coluna complementar de contexto para este mercado.</div>';
  }
}

function linha(nome,valor,max){
  return `
  <div class="row">
    <div class="label">${nome}</div>
    <div class="bar"><div class="fill" style="width:${(valor/max)*100}%"></div></div>
    <div class="value">${valor}%</div>
  </div>`;
}

function titulo(m){
  return {
    mediaGols:'MÃ©dia de gols (FT)',
    zeroZero:'Jogos 0x0 (FT)',
    over25:'Over 2.5 gols (FT)',
    under25:'Under 2.5 gols (FT)',
    vitoriasMandante:'VitÃ³rias do mandante (FT)',
    vitoriasVisitante:'VitÃ³rias do visitante (FT)',
    empates:'Empates (FT)'
  }[m];
}

function colunaDireitaTitulo(m){
  if(m==='over25') return 'Under 2.5 (FT)';
  if(m==='mediaGols') return 'Contexto';
  if(m==='zeroZero') return 'Contexto';
  return 'Contexto';
}

tabFT.onclick=()=>{aba='FT';ativar(tabFT);}
tabHTFT.onclick=()=>alert('HT Ã— FT permanece como na versÃ£o anterior.');
tabMV.onclick=()=>alert('Mandante Ã— Visitante permanece como na versÃ£o anterior.');

function ativar(btn){
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

mercado.onchange=render;

function alternarTema(){
  document.body.dataset.theme=document.body.dataset.theme==='dark'?'light':'dark';
}

carregar();
</script>

</body>
</html>
